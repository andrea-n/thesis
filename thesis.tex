%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% I, the copyright holder of this work, release this work into the
%% public domain. This applies worldwide. In some countries this may
%% not be legally possible; if so: I grant anyone the right to use
%% this work for any purpose, without any conditions, unless such
%% conditions are required by law.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[
  digital, %% This option enables the default options for the
           %% digital version of a document. Replace with `printed`
           %% to enable the default options for the printed version
           %% of a document.
  oneside, %% This option enables double-sided typesetting. Use at
           %% least 120 g/m² paper to prevent show-through. Replace
           %% with `oneside` to use one-sided typesetting; use only
           %% if you don’t have access to a double-sided printer,
           %% or if one-sided typesetting is a formal requirement
           %% at your faculty.
  table,   %% This option causes the coloring of tables. Replace
           %% with `notable` to restore plain LaTeX tables.
  nolof,     %% This option prints the List of Figures. Replace with
           %% `nolof` to hide the List of Figures.
  nolot,     %% This option prints the List of Tables. Replace with
           %% `nolot` to hide the List of Tables.
  %% More options are listed in the user guide at
  %% <http://mirrors.ctan.org/macros/latex/contrib/fithesis/guide/mu/fi.pdf>.
]{fithesis3}
%% The following section sets up the locales used in the thesis.
\usepackage[resetfonts]{cmap} %% We need to load the T2A font encoding
\usepackage[T1,T2A]{fontenc}  %% to use the Cyrillic fonts with Russian texts.
\usepackage[
  main=czech, %% By using `czech` or `slovak` as the main locale
                %% instead of `english`, you can typeset the thesis
                %% in either Czech or Slovak, respectively.
  english, german, russian, czech, slovak %% The additional keys allow
]{babel}        %% foreign texts to be typeset as follows:
%%
%%   \begin{otherlanguage}{german}  ... \end{otherlanguage}
%%   \begin{otherlanguage}{russian} ... \end{otherlanguage}
%%   \begin{otherlanguage}{czech}   ... \end{otherlanguage}
%%   \begin{otherlanguage}{slovak}  ... \end{otherlanguage}
%%
%% For non-Latin scripts, it may be necessary to load additional
%% fonts:
\usepackage{paratype}
\def\textrussian#1{{\usefont{T2A}{PTSerif-TLF}{m}{rm}#1}}
%%
%% The following section sets up the metadata of the thesis.
\thesissetup{
    date          = \the\year/\the\month/\the\day,
    university    = mu,
    faculty       = fi,
    type          = mgr,
    author        = Bc. Andrea Navrátilová,
    gender        = f,
    advisor       = {RNDr. Radek Ošlejšek, Ph.D.},
    title         = {Vizualizace pro dohled a analýzu bezpečnostních her},
    TeXtitle      = {Vizualizace pro dohled a~analýzu bezpečnostních her},
    keywords      = {KYPO, Capture the flag, CtF, bezpečnostní hry, vizualizace, D3.js, Angular, ...},
    TeXkeywords   = {KYPO, Capture the flag, CtF, bezpečnostní hry, vizualizace, D3.js, Angular, \ldots},
    abstract      = {This is the abstract of my thesis, which can

                     span multiple paragraphs.},
    thanks        = {These are the acknowledgements for my thesis, which can

                     span multiple paragraphs.}
}
\usepackage{makeidx}      %% The `makeidx` package contains
\makeindex                %% helper commands for index typesetting.
%% These additional packages are used within the document:
\usepackage{paralist} %% Compact list environments
\usepackage{amsmath}  %% Mathematics
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{url}      %% Hyperlinks
\usepackage{markdown} %% Lightweight markup
\usepackage{listings} %% Source code highlighting
\lstset{
  basicstyle      = \ttfamily,%
  identifierstyle = \color{black},%
  keywordstyle    = \color{blue},%
  keywordstyle    = {[2]\color{cyan}},%
  keywordstyle    = {[3]\color{olive}},%
  stringstyle     = \color{teal},%
  commentstyle    = \itshape\color{magenta}}
\usepackage{floatrow} %% Putting captions above tables
\usepackage[backend=bibtex]{biblatex}
\bibliography{bibliography} 
\floatsetup[table]{capposition=top}
\begin{document}
\chapter{Úvod}

\chapter{Kybernetický polygon}
Kybernetický polygon (KYPO) je projekt bezpečnostního týmu Masarykovy univerzity CSIRT-MU. Zabývá se výzkumem a vývojem unikátního prostředí pro analýzu hrozeb ohrožujících bezpečnost kritických informačních infrastruktur.\cite{kypocz}\par
Prostředí KYPO je virtualizační platforma postavená na cloudu umožňující simulace různých kybernetických útoků na libovolné infrastruktury. Lze vytvářet různorodé scénáře, které mohou obsahovat rozsáhlé počítačovové sítě virtuálních zařízení. Tyto dynamicky vytvářené sítě, tzv. sandboxy, mohou být libovolného rozsahu, na jejich zařízeních mohou běžet různé operační systémy a aplikace a jsou izolovány mezi sebou i od okolního světa. \cite{ctfDesign}
%% izolovány nebo izolovatelné?
%% sandboxy nejsou dynamicky vytvářené sítě

\section{Capture the Flag}
Platforma KYPO se mimo jiné využívá k výuce v oblasti bezpečnosti a k bezpečnostním školením. Vedle čistě obranných cvičení Cyber Defence eXercises (CDX) do této oblasti patří bezpečnostní hry s názvem Capture the Flag (CtF). \cite{ctfDesign} Jedná se o metodu aktivního učení, kde studenti přímo využívají své znalosti. CtF hry jsou zaměřeny na získávání a prohlubování znalostí v oblasti penetračního testování\footnote{Penetrační testování je proces, při kterém se pomocí současných útočných technik odhalují a využívají zranitelnosti systému, které by jinak mohli použít skuteční útočníci.}. Účastníci jsou postaveni do role útočníka, což by jim také mělo pomoci při předvídání případných útoků. \cite{lessons2015, ctfDesign}\par
Základní myšlenka vychází z klasické venkovní hry s tímto názvem, kde spolu soupeří dva týmy, jejichž úkolem je zajmout nepřátelskou vlajku a zároveň ubránit svou vlastní. V bezpečnostních CtF hrách jde o využití zranitelností systému a vlajka (flag) je ve formě unikátního textového řetězce.\par
Z hlediska zaměření se na útok nebo obranu mohou mít tyto hry různé modifikace: \cite{Dankovcikova2015thesis, ctfDesign}
\begin{itemize}
  \item pouze útok – založené na ofenzivních úlohách, kde tým je v pozici útočníka na danou infrastrukturu,
  \item kombinace útoku a obrany – klasické schéma, týmy útočí na sítě protivníků a zároveň brání svou vlastní,
  \item obrana nebo útok – kde jeden tým pouze brání a druhý útočí.
\end{itemize}
Útočná varianta je snadno škálovatelná a může se jí zúčastnit libovolný počet týmů. Účastníci následují daný scénář a hra bývá rozdělena do několika částí. Ty mohou být v závislosti na zvoleném formátu procházeny postupně, nebo volně podle výběru.\par
Oproti tomu varinta s obranou i útokem je vhodná pro menší počet týmů. Každý tým dostane svou vlastní síť a čas na navrhutí obrany a útoků. Body pak získávají za nalezené vlajky i obranu své sítě.\cite{Masarik2017thesis}

\section{Capture the Flag hry v KYPO}
Pro výukové účely byl do KYPO implementován modul pro vytváření a běh Ctf her. Pomocí portletů v Liferay portálu mohou vyučující hry spravovat a studenti získají přístup k rozhraní, které zajistí jejich průchod skrze hru. Také byl vytvořen prototyp hry zaměřený na výuku penetračního testování.\par
Při návrhu je třeba brát v úvahu nevyváženost ve znalostech a schopnostech jednotlivých hráčů či týmů. Ta může způsobit, že pro některé účastníky bude hra příliš obtížná nebo příliš snadná. Z tohoto důvodu je vhodné hru rozdělit na menší úseky a také zpřístupnit různé nápovědy, kterých budou moci hráči využít. Dále bývá žádoucí, aby hra proběhla s minimem potřebných zásahů vyučujících a úlohy jako vysvětlení pravidel, zadání úkolu či vyhodnocení byly v režii platformy.\cite{ctfDesign} 
\subsection{Návrh} \label{gameDesign}
Capture the Flag jsou v Kybernetickém polygonu navrženy jako útočné (attack-only) a může je hrát jak jeden samotný hráč, tak několik lidí v týmu, pro začátečníky může být hra v týmu vhodnější. Spuštěním více instancí paralelně lze hru koncipovat jako soutěž. Hry jsou rozděleny do několika po sobě jdoucích úrovní s relativně zvyšující se obtížností, zpravidla je jich menší počet (3–5). Každá tato úroveň má definovaný cíl, např. krádež dat ze vzdáleného serveru. Pro dokončení úrovně musí hráč nalézt správný flag, který je ve formě krátkého textového řetězce, typicky je to kontrolní součet nalezených dat. Za nalezení tohoto řešení hráči obdrží odpovídající počet bodů.\par
%% lze hru koncipovat jako soutěž - je to správně?
Na začátku hry se týmy seznámí s pravidly a poté vstoupí do první úrovně. Se vstupem do úrovně se zpřístupní její aktuální zadání společně s polem pro nalezené řešení. Na vyřešení úrovně má tým časový limit, který může s bodovou penalizací překročit. Tento po sekundách odpočítávaný limit má přiblížit simulaci reálným situacím, kde čas může hrát roli. Zároveň poskytuje hráčům určitý časový odhad a srovnání náročnosti s ostatními úrovněmi.\par
Pro případ, že tým již nemá dostatek času nebo má potíže s vyřešením úkolu, je v každé úrovni k dispozici určitý počet nápověd za cenu bodové penalizace. Nápovědy jsou volitelné a jejich výběr je možný na základě zobrazené informace o jejich povaze, např. jaký nástroj nebo příkaz má být zvolen či jak má být nástroj použit. Bodová penalizace se může pro různé nápovědy lišit. V případě, že ani s využitím nápověd tým nedokáže úroveň dokončit, má ještě možnost zobrazit si její řešení. Dále je týmu umožněno přeskočit úroveň a přejít do další nebo ukončit hru. Co se týká externích zdrojů nebo poznámek, jejich použití je v reálných situacích běžné, a proto může být jejich využití během hry povoleno. \cite{ctfDesign}\par
\subsection{Implementace}
Ctf hry jsou ve webovém portálu KYPO implementovány jako nový modul a skrze jeho portlety jsou poskytnuty pohledy pro tyto uživatelské role:
\begin{itemize}
  \item vyučující, který potřebuje hry vytvářet a spravovat,
  \item student, který potřebuje hrou projít.
\end{itemize}
Vyučující používá pro správu administrátorský portlet. Ten umožňuje přidávání, modifikaci a odstraňování jak her, tak i úrovní v rámci dané hry. Také lze upravovat úvod nebo pravidla hry a u jednotlivých úrovní je možné měnit jejich zadání, časový limit, bodové hodnocení a nápovědy s jejich penalizací. Mimo něj však musí vyučující poskytnout topologii sítě a připravit zařízení ve hře včetně operačního systému, aplikací a služeb. \cite{ctfDesign, Dankovcikova2015thesis}\par
%% vytváří typologii opravdu mimo portlet? ano
Student používá pro přístup do hry odlišný portlet reprezentující herní rozhraní, který poskytuje funkcionalitu popsanou v předchozí podkapitole \ref{gameDesign}.\par
Přístupy k zařízením v průběhu hry zajišťuje VNC portlet, který je jedním ze základních modulů portálu. VNC portlet dovoluje sdílení obrazovky virtuálních zařízení skrze VNC\footnote{Virtual Network Computing (VNC) je systém umožňující vzdálené připojení ke grafickému uživatelskému rozhraní.} spojení. Pomocí něj může vyučující přistupovat k sandboxům ve hře, což je užitečné zvláště v případech, kdy vyučující a studenti nejsou společně v jedné místnosti.\cite{ctfDesign}
%% je info o VNC portletu správně?
\subsection{Prototyp}
Za účelem testování nového modulu byl vytvořen prototyp hry pro výuku penetračního testování. Prototyp zahrnuje čtyři úrovně s konečným cílem přípravy NTP DDoS amplification\footnote{NTP amplification je DDoS útok, při kterém útočník využije Network Time Protocol (NTP) server k zahlcení cíle útoku. Princip „zesílení“ spočívá v tom, že požadavky zaslané na NTP server s podvrženou zdrojovou IP adresou, která je současně IP adresou cíle, jsou menší než vrácené odpovědi.} útoku.\par
Na začátku hry vidí účastníci jen topologii sítě bez podrobnějších informací a mají přístup k jedinému zařízení. Hra poté pokračuje čtyřmi úrovněmi zaměřenými na:
\begin{itemize}
  \item průzkum síťových služeb,
  \item vyhledání neveřejných informací,
  \item využití zranitelnosti serveru,
  \item přípravu DDoS amplification útoku.
\end{itemize}
Úkolem v první úrovni je prozkoumat síťové porty a zadat správný flag, což je seznam otevřených síťových portů. Hráčům je doporučen nástroj, který by měli použít, a dále jsou k dispozici dvě volitelné nápovědy. Jedna naznačí cíl skenování a užitečné vlastnosti nástroje, druhá zobrazí potřebný příkaz.\par
V druhé úrovni je flag jako VCE\footnote{Common Vulnerabilities and Exposures (VCE) je systém, ve kterém je každé známé zranitelnosti přiřazen jednoznačný identifikátor.} identifikátor, který má být získán z obsahu databáze použitím SQL injection. I zde jsou doporučeny nástroje k použití a připraveny dvě nápovědy, jako upřesnění zranitelného skriptu serveru nebo hlavní část příkazu.\par
V třetí úrovni má být tato nalezená zranitelnost využita k získání přístupu na server, kde se v lokálním souboru nachází aktuální flag. Připraveny jsou čtyři nápovědy. První nápověda pomáhá se spuštěním konzole nástroje, další s vyhledáním návodu na využití zranitelnosti, třetí ukáže potřebný modul nástroje Metasploit a poslední specifikuje název hledaného souboru.\par
V poslední čtvrté úrovni není cílem nalézt její flag, ale konfigurací NTP služby umožnit daný útok. Kontrola, zda je server správně nakonfigurován, se provede stisknutím tlačítka a v případě pozitivního vyhodnocení je hra úspěšně dokončena. Jedna z nápověd nasměruje hráče ke konfiguračnímu souboru a druhá poukáže na následnou potřebu restartování služby.

%%Úkolem v první úrovni je prozkoumat síťové porty a zadat správný flag, což je seznam otevřených síťových portů. V druhé úrovni je flag jako VCE\footnote{Common Vulnerabilities and Exposures (VCE) je systém, ve kterém je každé známé zranitelnosti přiřazen jednoznačný identifikátor.} identifikátor, který má být získán z obsahu databáze použitím SQL injection. V obou úrovních jsou doporučeny nástroje, které by měli být použity a jsou k dispozici dvě volitelné nápovědy. V třetí úrovni má být tato nalezená zranitelnost využita k získání přístupu na server, kde se v lokálním souboru nachází aktuální flag. Připraveny jsou čtyři nápovědy. V poslední čtvrté úrovni není cílem nalézt její flag, ale konfigurací NTP služby umožnit daný útok. Kontrola, zda je server správně nakonfigurován, se provede stisknutím tlačítka a v případě pozitivního vyhodnocení je hra úspěšně dokončena. Jedna z nápověd nasměruje hráče ke konfiguračnímu souboru a druhá poukáže na následnou potřebu restartování služby.



\subsection{Uživatelské testování}

\chapter{Návrh vizualizace}

\chapter{Použité technologie}
\section{D3.js}
\section{Bootstrap}
\section{Angular}
\section{Liferay}

\chapter{Implementace}
výběr grafu a jeho datová struktura

%% dát načítání na začátek nebo později?
\section{Načítání dat z CSV souboru}
\subsection{Struktura dat}
\subsection{Zpracování dat}
\subsection{Služba LoadCsvDataService}

\section{Načítání dat přes/skrze/pomocí REST API}
\subsection{Struktura dat}
\subsection{Zpracování dat}
\subsection{Služba LoadDataService}

\section{Struktura vizualizace}
\subsection{Vizualizace časového plánu}
odhad, timeline
\subsection{Vizualizace herních úrovní}
\subsection{Události}
\subsection{Sloupce s údaji}

\section{Ovládací prvky}
\subsection{Pohledy}
\subsection{Řazení}
\subsection{Filtrování}
\subsection{Zoom}

\section{Konfigurace}

\section{Testy}

\chapter{Závěr}

\printbibliography

\end{document}
